---
import "@styles/global.css";

import { SEO } from "astro-seo";

import Menu from "@components/Menu/Menu.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import GA4 from "@components/GA4.astro";
import SurferDecoration from "@components/SurferDecoration.svelte";

export interface Props {
  title?: string;
  description?: string;
  noindex?: boolean;
}

const props = Astro.props;

const BASE_TITLE = "株式会社ジョイゾー";
const title = props.title ? `${props.title} | ${BASE_TITLE}` : BASE_TITLE;
const BASE_DESCRIPTION =
  "ENJOY YOUR WORLD. 株式会社ジョイゾーは、DXと働き方の変化を通じて、お客様の世界をより楽しくすることを目指す企業です。";
const description = props.description ?? BASE_DESCRIPTION;
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <SEO
      title={title}
      description={description}
      noindex={props.noindex ?? false}
      charset="UTF-8"
      openGraph={{
        basic: {
          title,
          type: "website",
          image: `${import.meta.env.PUBLIC_SITE_URL}/og.png`,
        },
      }}
      extend={{
        link: [{ rel: "icon", href: "/favicon.ico" }],

        meta: [
          { name: "viewport", content: "width=device-width" },
          { name: "twitter:card", content: "summary_large_image" },
        ],
      }}
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique:wght@300;400;500;700;900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+Antique:wght@300;400;500;700;900&display=swap" rel="stylesheet" /></noscript>

    {import.meta.env.PUBLIC_GOOGLE_ANALYTICS_ID && <GA4 />}
  </head>
  <body class="font-serif leading-loose text-main">
    <Header />
    <main class="overflow-x-hidden">
      <slot />
    </main>
    <Footer />

    <Menu />
    
    <!-- サーファー装飾コンポーネント -->
    <SurferDecoration client:load />

    <script>
      import "@global/smallDevice";
      // import "@global/smoothScroll"; // スクロール処理の競合を避けるため完全に無効化
    </script>
    
    
    <!-- プリフェッチエラー対策 -->
    <script>
      // ネットワークエラーのハンドリング
      window.addEventListener('error', (event) => {
        if (event.message && event.message.includes('Cannot prefetch')) {
          console.log('Prefetch error ignored - network conditions are poor');
          event.preventDefault();
        }
      });
      
      // Promise rejection のハンドリング
      window.addEventListener('unhandledrejection', (event) => {
        if (event.reason && event.reason.message && event.reason.message.includes('Cannot prefetch')) {
          console.log('Prefetch promise rejection ignored');
          event.preventDefault();
        }
      });
    </script>
  </body>
</html>
