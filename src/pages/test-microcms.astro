---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Micro CMS 接続テスト">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Micro CMS 接続テスト</h1>
    
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
      <h2 class="text-lg font-semibold text-blue-800 mb-2">テスト手順</h2>
      <ol class="list-decimal list-inside text-blue-700 space-y-1">
        <li>このページを開く</li>
        <li>ブラウザの開発者ツール（F12）を開く</li>
        <li>コンソールタブを確認</li>
        <li>接続テストの結果を確認</li>
      </ol>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-white border border-gray-200 rounded-lg p-4">
        <h3 class="font-semibold mb-2">ニュース</h3>
        <p class="text-sm text-gray-600">newsエンドポイントの接続テスト</p>
      </div>
      

      
      <div class="bg-white border border-gray-200 rounded-lg p-4">
        <h3 class="font-semibold mb-2">ページ</h3>
        <p class="text-sm text-gray-600">pagesエンドポイントの接続テスト</p>
      </div>
    </div>
    
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
      <h2 class="text-lg font-semibold text-yellow-800 mb-2">注意事項</h2>
      <ul class="list-disc list-inside text-yellow-700 space-y-1">
        <li>環境変数（.env）が正しく設定されていることを確認してください</li>
        <li>Micro CMSのサービスドメインとAPIキーが正しいことを確認してください</li>
        <li>各エンドポイント（news, menu, gallery）がMicro CMSで作成されていることを確認してください</li>
      </ul>
    </div>
  </div>
</Layout>

<script>
  import { testMicroCMSConnection, getEndpointInfo } from "../../tests/microcms-connection.test";
  
  // ページ読み込み時に接続テストを実行
  document.addEventListener('DOMContentLoaded', async () => {
    console.log("🚀 ページが読み込まれました。接続テストを開始します...");
    
    // 基本的な接続テスト
    const connectionResult = await testMicroCMSConnection();
    
    if (connectionResult) {
      console.log("\n📋 詳細情報の取得を試行します...");
      
      // 各エンドポイントの詳細情報を取得
      try {
        await getEndpointInfo("news");
      } catch (error) {
        console.log("ニュースの詳細取得はスキップしました");
      }
      

      
      try {
        await getEndpointInfo("pages");
      } catch (error) {
        console.log("ページの詳細取得はスキップしました");
      }
    }
  });
</script>
